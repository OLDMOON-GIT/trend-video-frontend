# íŠ¸ë Œë“œ ë¹„ë””ì˜¤ ìë™í™” ê¸°ëŠ¥ ëª©ë¡

## ìƒí’ˆ ìë™í™” ê¸°ëŠ¥

### í…ŒìŠ¤íŠ¸ ê¸°ëŠ¥ì—ì„œì˜ ìƒí’ˆ ìë™í™”
**êµ¬í˜„ ìœ„ì¹˜**: `src/app/api/automation/test-generate-stream/route.ts`

**ë™ì‘ íë¦„**:

#### Step 1: ë² ìŠ¤íŠ¸ì…€ëŸ¬ì—ì„œ ìƒí’ˆ ì¡°íšŒ
1. **ì¿ íŒ¡ ë² ìŠ¤íŠ¸ì…€ëŸ¬ API í˜¸ì¶œ**
   - `/v2/providers/affiliate_open_api/apis/openapi/v1/products/bestcategories/1001`
   - HMAC-SHA256 ì„œëª…ìœ¼ë¡œ ì¸ì¦
   - ë² ìŠ¤íŠ¸ì…€ëŸ¬ ìˆœìœ„ ìƒí’ˆ ìë™ ì„ íƒ

#### Step 2: ë”¥ë§í¬ ìƒì„±
1. **ë”¥ë§í¬ API í˜¸ì¶œ**
   - ë² ìŠ¤íŠ¸ì…€ëŸ¬ ìƒí’ˆ URLì„ ë”¥ë§í¬ë¡œ ë³€í™˜
   - `/v2/providers/affiliate_open_api/apis/openapi/v1/deeplink` í˜¸ì¶œ
   - `https://link.coupang.com/a/xxxxx` í˜•íƒœë¡œ ë³€í™˜
   - ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë°œìƒ (ì›ë³¸ URL ì‚¬ìš© ì•ˆ í•¨)

2. **DB ì €ì¥ ë°©ì‹**
   - `video_titles.product_url` = ìƒì„±ëœ ë”¥ë§í¬ (short URL)
   - `video_titles.product_data` JSONì— ì €ì¥:
     - `deepLink`: ìƒì„±ëœ ë‹¨ì¶• ë§í¬
     - `productUrl`: ì›ë³¸ Coupang URL (ì°¸ê³ ìš©)
   - ì˜ˆì‹œ:
     ```json
     {
       "deepLink": "https://link.coupang.com/a/c59d9h",
       "productUrl": "https://www.coupang.com/vp/products/...",
       "productName": "ìƒí’ˆëª…",
       "productPrice": 7500
     }
     ```

3. **ìˆ˜ì • í¼ì—ì„œì˜ ì²˜ë¦¬**
   - `startEdit()` í•¨ìˆ˜ê°€ product_dataì˜ `deepLink` ìš°ì„  ì¶”ì¶œ
   - product_dataì— deepLinkê°€ ìˆìœ¼ë©´ ê·¸ê²ƒì„ ì‚¬ìš©
   - ì—†ìœ¼ë©´ product_dataì˜ productUrl ì‚¬ìš©
   - ê·¸ê²ƒë„ ì—†ìœ¼ë©´ DBì˜ product_url ì»¬ëŸ¼ ì‚¬ìš©

#### Step 3: ë‚´ ëª©ë¡(ë‚´ëª©ë¡)ì— ì¶”ê°€
1. **ì¤‘ë³µ ìƒí’ˆ ì²´í¬** âœ… (êµ¬í˜„ ì™„ë£Œ)
   - ì´ë¯¸ ë‚´ ëª©ë¡ì— ìˆëŠ” ìƒí’ˆì¸ì§€ ë¨¼ì € í™•ì¸
   - `product_url`ë¡œ ì¤‘ë³µ ì²´í¬
   - ì¤‘ë³µì´ë©´ ìŠ¤í‚µ, ì—†ìœ¼ë©´ ì¶”ê°€
   - ê°™ì€ ìƒí’ˆì„ ì—¬ëŸ¬ ë²ˆ í…ŒìŠ¤íŠ¸í•´ë„ ë‚´ ëª©ë¡ì—ëŠ” í•œ ë²ˆë§Œ ì €ì¥

2. **ìƒí’ˆ ì €ì¥ ë¡œì§** âœ… (êµ¬í˜„ ì™„ë£Œ)
   - `coupang_products` í…Œì´ë¸”ì— ìƒí’ˆ INSERT (test-generate-streamì—ì„œ ìë™ ì‹¤í–‰)
   - ì €ì¥ í•­ëª©:
     - `id` (ìë™ ìƒì„± ID)
     - `user_id` (ì‚¬ìš©ì ID)
     - `product_url` (ì¿ íŒ¡ ìƒí’ˆ URL)
     - `deep_link` (ìƒì„±ëœ ë”¥ë§í¬)
     - `title` (ìƒí’ˆëª…)
     - `category` (ì¹´í…Œê³ ë¦¬)
     - `image_url` (ìƒí’ˆ ì´ë¯¸ì§€)
     - `original_price`, `discount_price` (ê°€ê²©)
     - `status` ('active')
   - ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ìë™ìœ¼ë¡œ ê°ì§€

#### Step 4: ìŠ¤ì¼€ì¤„ëŸ¬ ìë™í™” - ì˜ˆì•½í ìë™ ë“±ë¡
1. **ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ì‹ ê·œ ìƒí’ˆ ê°ì§€** âœ… (êµ¬í˜„ ì™„ë£Œ)
   - `checkAndRegisterCoupangProducts()` í•¨ìˆ˜ê°€ coupang_products í…Œì´ë¸” ëª¨ë‹ˆí„°ë§
   - 3ì´ˆ ê°„ê²©ìœ¼ë¡œ ì‹ ê·œ ìƒí’ˆ ê°ì§€
   - êµ¬í˜„ ìœ„ì¹˜: `src/lib/automation-scheduler.ts` Line 1720

2. **ìë™ ìŠ¤ì¼€ì¤„ ìƒì„±** âœ… (êµ¬í˜„ ì™„ë£Œ)
   - `video_titles` í…Œì´ë¸”ì— íƒ€ì´í‹€ ìƒì„±
   - ìƒí’ˆ ì •ë³´ ì €ì¥ (product_data JSON)
   - `video_schedules` í…Œì´ë¸”ì— ìŠ¤ì¼€ì¤„ ìë™ ë“±ë¡
   - ì‚¬ìš©ìì˜ í™œì„± ì±„ë„ë¡œ ìë™ ë°°ì •
   - YouTube í”„ë¼ì´ë²„ì‹œ: ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •

3. **ì˜ˆì•½í ìë™ ì‹¤í–‰** âœ… (ê¸°ì¡´ êµ¬í˜„)
   - ìŠ¤ì¼€ì¤„ëœ ì‹œê°„ì— ìë™ìœ¼ë¡œ ì²˜ë¦¬
   - ëŒ€ë³¸ ìƒì„± â†’ ì˜ìƒ ìƒì„± â†’ YouTube ì—…ë¡œë“œ
   - ì „ì²´ í”„ë¡œì„¸ìŠ¤ ìë™í™”

**ê´€ë ¨ íŒŒì¼**:
- `src/app/api/automation/test-generate-stream/route.ts` - í…ŒìŠ¤íŠ¸ ê¸°ëŠ¥ ë° ë² ìŠ¤íŠ¸ì…€ëŸ¬ ì¡°íšŒ
- `src/lib/coupang-deeplink.ts` - ë”¥ë§í¬ ìƒì„± ìœ í‹¸ë¦¬í‹°
- `src/lib/automation-scheduler.ts` - ìŠ¤ì¼€ì¤„ëŸ¬ (ì‹ ê·œ ìƒí’ˆ ê°ì§€ ë° ìë™ ë“±ë¡)
- `src/app/api/coupang/products/route.ts` - ë² ìŠ¤íŠ¸ì…€ëŸ¬ ì¡°íšŒ API

**íŠ¹ì§•**:
- âœ… ë² ìŠ¤íŠ¸ì…€ëŸ¬ì—ì„œ ìƒí’ˆ ìë™ ì¡°íšŒ
- âœ… ë”¥ë§í¬ ìë™ ìƒì„±
- âœ… ë‚´ ëª©ë¡ì— ìë™ ì¶”ê°€
- âœ… ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ìë™ìœ¼ë¡œ ê°ì§€
- âœ… ì˜ˆì•½íì— ìë™ ë“±ë¡
- âœ… ì˜ˆì•½ëœ ì‹œê°„ì— ì˜ìƒ ìƒì„± ë° ì—…ë¡œë“œ

**ìƒíƒœ**: âœ… ì™„ì „ êµ¬í˜„ (Step 1 ~ 4 ëª¨ë‘ ì™„ë£Œ)

---

## ìë™í™” ìƒí’ˆì¹´í…Œê³ ë¦¬ (Product Category Automation)

**ê¸°ëŠ¥ ì„¤ëª…**: ì¿ íŒ¡ ë² ìŠ¤íŠ¸ì…€ëŸ¬ì—ì„œ ìƒˆë¡œìš´ ìƒí’ˆì„ ê°€ì ¸ì™€ ë‚´ëª©ë¡ì— ë“±ë¡í•˜ê³ , ì¹´í…Œê³ ë¦¬ë³„ë¡œ ì˜ˆì•½íë¥¼ ìë™ ë“±ë¡

**ë™ì‘ íë¦„**:

### Step 1: ë² ìŠ¤íŠ¸ì…€ëŸ¬ì—ì„œ ì‹ ê·œ ìƒí’ˆ ì¡°íšŒ
1. ì¿ íŒ¡ ë² ìŠ¤íŠ¸ì…€ëŸ¬ API í˜¸ì¶œ
   - `/v2/providers/affiliate_open_api/apis/openapi/v1/products/bestcategories/[CATEGORY_ID]`
   - ê° ì¹´í…Œê³ ë¦¬ë³„ ë² ìŠ¤íŠ¸ì…€ëŸ¬ ìƒí’ˆ ëª©ë¡ ì¡°íšŒ

2. **ë‚´ëª©ë¡ ì¤‘ë³µ ì²´í¬**
   - `coupang_products` í…Œì´ë¸”ì—ì„œ ì´ë¯¸ ë“±ë¡ëœ ìƒí’ˆ ì¡°íšŒ
   - ë² ìŠ¤íŠ¸ì…€ëŸ¬ ìƒí’ˆê³¼ ë¹„êµí•˜ì—¬ **ë¯¸ë“±ë¡ ì‹ ê·œ ìƒí’ˆë§Œ í•„í„°ë§**

3. **ì‹ ê·œ ìƒí’ˆ ì„ íƒ**
   - ë¯¸ë“±ë¡ ìƒí’ˆ ì¤‘ ìˆœìœ„ê°€ ë†’ì€ ìƒí’ˆë¶€í„° ì„ íƒ (ìƒìœ„ 5ê°œ~10ê°œ)

### Step 2: ë”¥ë§í¬ ìƒì„± ë° ë‚´ëª©ë¡ ë“±ë¡
1. **ë”¥ë§í¬ ìƒì„±**
   - ë² ìŠ¤íŠ¸ì…€ëŸ¬ APIì˜ ê¸´ affiliate URL â†’ ì§§ì€ ë”¥ë§í¬ ë³€í™˜
   - `generateDeeplink()` í•¨ìˆ˜ë¡œ ë³€í™˜
   - `https://link.coupang.com/a/xxxxx` í˜•íƒœ

2. **ë‚´ëª©ë¡ì— ìƒí’ˆ ë“±ë¡**
   - `coupang_products` í…Œì´ë¸”ì— INSERT
   - ì €ì¥ í•­ëª©:
     - `product_id` (ì¿ íŒ¡ ìƒí’ˆ ID)
     - `product_name` (ìƒí’ˆëª…)
     - `deep_link` (ìƒì„±ëœ ë”¥ë§í¬)
     - `category_id` (ì¹´í…Œê³ ë¦¬ ID)
     - `image_url` (ìƒí’ˆ ì´ë¯¸ì§€)
     - `original_price`, `discount_price` (ê°€ê²©)
     - `status` ('active')

### Step 3: ì¹´í…Œê³ ë¦¬ë³„ ìë™ ì˜ˆì•½í ë“±ë¡
1. **ìƒí’ˆ ì •ë³´ ì¤€ë¹„**
   - ë“±ë¡ëœ ìƒí’ˆì˜ ìƒì„¸ ì •ë³´ ì¡°íšŒ
   - ì¹´í…Œê³ ë¦¬ì— ë§ëŠ” AI í”„ë¡¬í”„íŠ¸ ì„ íƒ

2. **íƒ€ì´í‹€ ìë™ ìƒì„±**
   - ìƒí’ˆ ì •ë³´ ê¸°ë°˜ AI íƒ€ì´í‹€ ìƒì„±
   - `video_titles` í…Œì´ë¸”ì— ì €ì¥
   - ìƒí’ˆ ì¹´í…Œê³ ë¦¬ë³„ë¡œ ë§ì¶¤í˜• íƒ€ì´í‹€ ìƒì„±

3. **ì¹´í…Œê³ ë¦¬ë³„ ìŠ¤ì¼€ì¤„ ìë™ ë“±ë¡**
   - ì¹´í…Œê³ ë¦¬ì— ë”°ë¼ ì±„ë„ ìë™ ë°°ì • (ì˜ˆ: "ì˜ë¥˜" â†’ íŒ¨ì…˜ ì±„ë„)
   - `video_schedules` í…Œì´ë¸”ì— INSERT
   - ìë™ìœ¼ë¡œ ìŠ¤ì¼€ì¤„ ì‹œê°„ ì„¤ì • (ì¹´í…Œê³ ë¦¬ë³„ ìµœì  ì—…ë¡œë“œ ì‹œê°„)
   - YouTube í”„ë¼ì´ë²„ì‹œ: 'public'ìœ¼ë¡œ ì„¤ì •

4. **ìƒíƒœ ì—…ë°ì´íŠ¸**
   - `video_titles` ìƒíƒœ: 'pending' â†’ 'scheduled'
   - `video_schedules` ìƒíƒœ: 'pending'

**êµ¬í˜„ ìœ„ì¹˜**:
- `src/app/api/automation/test-generate-stream/route.ts` - ë©”ì¸ ë¡œì§ (Step 1, 2)
- `src/app/api/automation/[category]/auto-schedule/route.ts` - ì¹´í…Œê³ ë¦¬ë³„ ìë™ ìŠ¤ì¼€ì¤„ (Step 3) **[í•„ìš”]**
- `src/lib/coupang-deeplink.ts` - ë”¥ë§í¬ ìƒì„±
- `src/lib/automation.ts` - DB ì¿¼ë¦¬ í•¨ìˆ˜

**ê´€ë ¨ í…Œì´ë¸”**:
```sql
-- coupang_products: ë‚´ëª©ë¡ ìƒí’ˆ
CREATE TABLE coupang_products (
  id TEXT PRIMARY KEY,
  product_id TEXT,
  product_name TEXT,
  deep_link TEXT,
  category_id TEXT,          -- ì¹´í…Œê³ ë¦¬ ID
  image_url TEXT,
  original_price INTEGER,
  discount_price INTEGER,
  status TEXT DEFAULT 'active'
);

-- video_titles: ìƒì„±ëœ íƒ€ì´í‹€
CREATE TABLE video_titles (
  id TEXT PRIMARY KEY,
  title TEXT,
  type TEXT,
  category TEXT,             -- ì¹´í…Œê³ ë¦¬ ('ì˜ë¥˜', 'ê°€ì „', 'ì‹í’ˆ' ë“±)
  product_url TEXT,          -- ì¿ íŒ¡ ë”¥ë§í¬
  status TEXT DEFAULT 'pending'
);

-- video_schedules: ì˜ˆì•½í
CREATE TABLE video_schedules (
  id TEXT PRIMARY KEY,
  title_id TEXT,
  product_url TEXT,          -- ì¿ íŒ¡ ë”¥ë§í¬
  channel TEXT,              -- ì¹´í…Œê³ ë¦¬ë³„ ìë™ ë°°ì • ì±„ë„
  youtube_privacy TEXT DEFAULT 'public',
  status TEXT DEFAULT 'pending'
);
```

**íŠ¹ì§•**:
- âœ… ì™„ì „ ìë™í™”: ì‚¬ìš©ì ê°œì… ì—†ìŒ
- âœ… ì‹ ê·œ ìƒí’ˆë§Œ ë“±ë¡: ë‚´ëª©ë¡ ì¤‘ë³µ ì²´í¬
- âœ… ì¹´í…Œê³ ë¦¬ ë§ì¶¤: ì¹´í…Œê³ ë¦¬ë³„ ì±„ë„/íƒ€ì´í‹€ ìµœì í™”
- âœ… ì¦‰ì‹œ ìŠ¤ì¼€ì¤„: ë“±ë¡ í›„ ìë™ìœ¼ë¡œ ì˜ˆì•½í ìƒì„±

**ìƒíƒœ**: âš ï¸ ë¶€ë¶„ êµ¬í˜„ (Step 1, 2ëŠ” ì™„ë£Œ, Step 3 ë¯¸êµ¬í˜„)

---

## ìƒí’ˆ íƒ€ì´í‹€ ìë™ ìƒì„±

**êµ¬í˜„ ìœ„ì¹˜**: `src/app/api/automation/titles/route.ts`

**ë™ì‘ íë¦„**:
1. **ìƒí’ˆ ì •ë³´ ì¡°íšŒ**
   - ì¿ íŒ¡ ìƒí’ˆ URLì—ì„œ ìƒí’ˆ ID ì¶”ì¶œ
   - APIë¥¼ í†µí•´ ìƒí’ˆ ì´ë¦„, ê°€ê²©, ì¹´í…Œê³ ë¦¬ ë“± ì¡°íšŒ

2. **AI íƒ€ì´í‹€ ìƒì„±**
   - ìƒí’ˆ ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í”„ë¡¬í”„íŠ¸ ìƒì„±
   - Claude/ChatGPT API í˜¸ì¶œ
   - ìœ íŠœë¸Œ ìµœì í™” íƒ€ì´í‹€ ìƒì„±

3. **íƒ€ì´í‹€ ì €ì¥**
   - `video_titles` í…Œì´ë¸”ì— ì €ì¥
   - ìƒí’ˆ ì •ë³´(JSON) í•¨ê»˜ ì €ì¥

**ê´€ë ¨ íŒŒì¼**:
- `src/app/api/automation/titles/route.ts` - íƒ€ì´í‹€ API
- `src/lib/automation.ts` - DB ì¿¼ë¦¬ í•¨ìˆ˜

**ìƒíƒœ**: âš ï¸ ë¶€ë¶„ êµ¬í˜„ (ìˆ˜ë™ ì…ë ¥ì€ ê°€ëŠ¥, ìë™ ìƒì„±ì€ ë¯¸êµ¬í˜„)

---

## ìë™í™” ìŠ¤ì¼€ì¤„ ê´€ë¦¬

**êµ¬í˜„ ìœ„ì¹˜**: `src/app/api/automation/schedules/route.ts`

**ë™ì‘ íë¦„**:
1. **ìŠ¤ì¼€ì¤„ ìƒì„±**
   - íƒ€ì´í‹€ ì„ íƒ
   - ì±„ë„ ì„ íƒ
   - ì—…ë¡œë“œ ë‚ ì§œ/ì‹œê°„ ì„¤ì •
   - YouTube í”„ë¼ì´ë²„ì‹œ ì„¤ì •

2. **ìŠ¤ì¼€ì¤„ ì¡°íšŒ**
   - ì±„ë„ë³„ ìŠ¤ì¼€ì¤„ ì¡°íšŒ
   - ìƒíƒœë³„ ìŠ¤ì¼€ì¤„ í•„í„°ë§ (pending, processing, completed, failed, cancelled)
   - ë‹¬ë ¥ ë·°ë¡œ ì¡°íšŒ

3. **ìŠ¤ì¼€ì¤„ ì‹¤í–‰**
   - `video_schedules` í…Œì´ë¸”ì—ì„œ pending ìƒíƒœ ì¡°íšŒ
   - ìë™í™” ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ì´ë¥¼ ì²˜ë¦¬

**ê´€ë ¨ íŒŒì¼**:
- `src/app/api/automation/schedules/route.ts` - ìŠ¤ì¼€ì¤„ ê´€ë¦¬ API
- `src/app/api/automation/calendar/route.ts` - ìº˜ë¦°ë” ì¡°íšŒ API
- `src/lib/automation.ts` - DB ì¿¼ë¦¬ í•¨ìˆ˜
- `src/lib/automation-scheduler.ts` - ìŠ¤ì¼€ì¤„ ì‹¤í–‰ ë¡œì§

**ìƒíƒœ**: âœ… ì™„ë£Œ

---

## ìë™í™” ìŠ¤ì¼€ì¤„ëŸ¬ (ìë™ ì‹¤í–‰)

**êµ¬í˜„ ìœ„ì¹˜**: `src/lib/automation-scheduler.ts`

### ğŸ“‹ ì™„ì „í•œ ìë™í™” íŒŒì´í”„ë¼ì¸

```
[Stage 1: ëŒ€ë³¸ ìƒì„±]           [Stage 2: ì˜ìƒ ìƒì„±]           [Stage 3: ì—…ë¡œë“œ]           [Stage 4: í¼ë¸”ë¦¬ì‹œ]
        â†“                              â†“                           â†“                          â†“
  ìŠ¤í¬ë¦½íŠ¸ ìƒì„± API        ì´ë¯¸ì§€/ì˜ìƒ ìƒì„± API       YouTube ì—…ë¡œë“œ API      í¼ë¸”ë¦¬ì‹œ ì˜ˆì•½
```

---

### **Step 1: ìŠ¤ì¼€ì¤„ ê°ì‹œ ë° ì²˜ë¦¬ (3ì´ˆ ê°„ê²©)**

#### 1-1. Pending ìŠ¤ì¼€ì¤„ ê°ì‹œ
- **í•¨ìˆ˜**: `processPendingSchedules()` (Line 150)
- **ë™ì‘**:
  - `video_schedules` í…Œì´ë¸”ì—ì„œ `status='pending'` ìŠ¤ì¼€ì¤„ ì¡°íšŒ
  - `scheduled_time <= í˜„ì¬ì‹œê°„` ìŠ¤ì¼€ì¤„ë§Œ ì²˜ë¦¬
  - ì¡°íšŒ ì‹œ í•¨ê»˜ ê°€ì ¸ì˜¤ëŠ” ì •ë³´:
    - ì œëª©, íƒ€ì…, ì¹´í…Œê³ ë¦¬, íƒœê·¸
    - **media_mode** (upload / dalle / imagen3 / sora2) âœ… NEW
    - ëª¨ë¸ ì •ë³´, YouTube ì„¤ì •

#### 1-2. íŒŒì´í”„ë¼ì¸ ìƒì„±
- **í•¨ìˆ˜**: `createPipeline()` (Line 583)
- **ë™ì‘**:
  - 4ë‹¨ê³„ íŒŒì´í”„ë¼ì¸ ìƒì„±:
    1. script (ëŒ€ë³¸ ìƒì„±)
    2. video (ì˜ìƒ ìƒì„±)
    3. upload (YouTube ì—…ë¡œë“œ)
    4. publish (í¼ë¸”ë¦¬ì‹œ)
  - ê° ë‹¨ê³„ë¥¼ `automation_pipelines` í…Œì´ë¸”ì— ê¸°ë¡

---

### **Step 2: ëŒ€ë³¸ ìƒì„± (Stage 1: Script)**

#### 2-1. API í˜¸ì¶œ
- **API**: `POST /api/scripts/generate`
- **ì „ë‹¬ ì •ë³´**:
  - title: ì œëª©
  - type: ì½˜í…ì¸  íƒ€ì… (product, longform, shortform, sora2)
  - model: AI ëª¨ë¸ (claude, chatgpt, gemini, groq)
  - productInfo: ìƒí’ˆ ì •ë³´ (ìƒí’ˆ íƒ€ì…ì¼ ê²½ìš°)
  - category: ì¹´í…Œê³ ë¦¬

#### 2-2. ê²°ê³¼ ì €ì¥
- `contents` í…Œì´ë¸”ì— ëŒ€ë³¸ ì €ì¥
- `video_schedules`ì— `script_id` ê¸°ë¡
- íŒŒì´í”„ë¼ì¸ ìƒíƒœë¥¼ 'completed'ë¡œ ì—…ë°ì´íŠ¸

#### 2-3. ì¤‘ìš”: ì§ì ‘ ì—…ë¡œë“œ ëª¨ë“œ ê°ì§€ â­
```typescript
if (mediaMode === 'upload') {
  // story.json ìƒì„±
  // waiting_for_upload ìƒíƒœë¡œ ë³€ê²½
  // return â†’ ì˜ìƒ ìƒì„± ìŠ¤í‚µ!

  updateScheduleStatus(schedule.id, 'waiting_for_upload', { scriptId });
  addTitleLog(schedule.title_id, 'info', 'â¸ï¸ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.');
  return; // ì—¬ê¸°ì„œ ë©ˆì¶¤!
}
```
- **ì˜ë¯¸**: ì‚¬ìš©ìê°€ ì´ë¯¸ì§€ë¥¼ ì§ì ‘ ì¤€ë¹„í•  ë•Œê¹Œì§€ ëŒ€ê¸°
- **ë‹¤ìŒ ë‹¨ê³„**: ì‚¬ìš©ìê°€ "ì´ë¯¸ì§€ í¬ë¡¤ë§" ë²„íŠ¼ í´ë¦­

---

### **Step 3: ì´ë¯¸ì§€ ì—…ë¡œë“œ ëŒ€ê¸° (ì¤‘ë‹¨ì )**

#### 3-1. ìƒíƒœ: `waiting_for_upload`
- **ì¡°íšŒ í•¨ìˆ˜**: `getWaitingForUploadSchedules()` (Line 1271)
- **ë™ì‘**:
  - ìŠ¤ì¼€ì¤„ëŸ¬ê°€ 3ì´ˆë§ˆë‹¤ waiting_for_upload ìŠ¤ì¼€ì¤„ í™•ì¸
  - í”„ë¡œì íŠ¸ í´ë”ì—ì„œ ì´ë¯¸ì§€ íŒŒì¼ ê°ì§€
    ```
    project_{scriptId}/
      â”œâ”€â”€ story.json
      â”œâ”€â”€ scene_01_image.png    â† ê°ì§€!
      â”œâ”€â”€ scene_02_image.png
      â””â”€â”€ ...
    ```

#### 3-2. ì‚¬ìš©ì ì•¡ì…˜: ì´ë¯¸ì§€ í¬ë¡¤ë§
- **UI**: ìë™í™” í˜ì´ì§€ â†’ "ğŸ–¼ï¸ ì´ë¯¸ì§€ í¬ë¡¤ë§" ë²„íŠ¼
- **ë™ì‘**:
  1. `/api/crawl-images` API í˜¸ì¶œ
  2. ëŒ€ë³¸ì˜ ê° sceneë§ˆë‹¤ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
  3. `project_{scriptId}/` í´ë”ì— ì €ì¥
  4. scene_01_image.png, scene_02_image.png, ... í˜•íƒœë¡œ ì €ì¥

#### 3-3. ì´ë¯¸ì§€ ê°ì§€ ë° ìë™ ì§„í–‰
- **í•¨ìˆ˜**: `checkWaitingForUploadSchedules()` (Line 1271)
- **ë™ì‘**:
  ```typescript
  if (imageFiles.length > 0) {
    // âœ… ì´ë¯¸ì§€ ê°ì§€!
    updateScheduleStatus(schedule.id, 'processing');
    resumeVideoGeneration(schedule, videoPipelineId); // ì˜ìƒ ìƒì„± ì¬ê°œ
  }
  ```

---

### **Step 4: ì˜ìƒ ìƒì„± (Stage 2: Video)**

#### 4-1. í•¨ìˆ˜: `generateVideo()` (Line 736)

#### 4-2. ì‚¬ì „ ì¤€ë¹„
```typescript
const mediaMode = schedule.media_mode || 'upload'; // âœ… ì§ì ‘ ì—…ë¡œë“œë©´ 'upload'
const imageSource = (mediaMode === 'upload' || hasUploadedImages) ? 'none' : mediaMode;
```
- **imageSource='none'**: ì§ì ‘ ì—…ë¡œë“œí•œ ì´ë¯¸ì§€ ì‚¬ìš© (ìë™ ìƒì„± X)
- **imageSource='dalle'**: DALL-E ì´ìš©í•´ ì´ë¯¸ì§€ ìë™ ìƒì„±
- **imageSource='imagen3'**: Google Imagen3 ì´ìš©í•´ ì´ë¯¸ì§€ ìë™ ìƒì„±

#### 4-3. Python ë°±ì—”ë“œ í˜¸ì¶œ
```bash
python create_video_from_folder.py \
  --folder input/project_{scriptId} \
  --image-source {imageSource} \
  --aspect-ratio {16:9 or 9:16} \
  --voice ko-KR-SoonBokNeural \
  --image-provider {openai or imagen3} \
  --job-id {jobId}
```

#### 4-4. ë°±ì—”ë“œ ì²˜ë¦¬
**íŒŒì¼**: `trend-video-backend/create_video_from_folder.py`
- story.json + ì´ë¯¸ì§€ë¡œ ì˜ìƒ ìƒì„±
- **ì¤‘ìš”**: imageSource='none'ì´ë©´ ìë™ ìƒì„± ì•ˆí•¨
  ```python
  if self.image_source in ["google", "dalle", "imagen3"]:
      images = self._download_missing_images(images)
  # else: ì•„ë¬´ê²ƒë„ ì•ˆí•¨ (ì§ì ‘ ì—…ë¡œë“œ ì´ë¯¸ì§€ë§Œ ì‚¬ìš©)
  ```

#### 4-5. ì˜ìƒ ì €ì¥
- MP4 íŒŒì¼ ìƒì„±
- `video_schedules`ì— `video_id` ê¸°ë¡
- íŒŒì´í”„ë¼ì¸ ìƒíƒœë¥¼ 'completed'ë¡œ ì—…ë°ì´íŠ¸

---

### **Step 5: YouTube ì—…ë¡œë“œ (Stage 3: Upload)**

#### 5-1. í•¨ìˆ˜: `uploadToYouTube()` (Line 921)

#### 5-2. ì—…ë¡œë“œ ì „ ì²˜ë¦¬
- ì˜ìƒ ë©”íƒ€ë°ì´í„° ì¤€ë¹„:
  - ì œëª©: `[ê´‘ê³ ] {ìƒí’ˆëª…}` (ìƒí’ˆì¸ ê²½ìš°)
  - ì„¤ëª…: ìƒí’ˆ ì„¤ëª… + êµ¬ë§¤ ë§í¬ (ìƒí’ˆì¸ ê²½ìš°)
  - íƒœê·¸: ì¹´í…Œê³ ë¦¬, ì±„ë„, íƒœê·¸
  - ì¸ë„¤ì¼: ì²« í”„ë ˆì„ ë˜ëŠ” ìƒí’ˆ ì´ë¯¸ì§€

#### 5-3. YouTube API í˜¸ì¶œ
- OAuth 2.0 ì¸ì¦
- `youtube.videos().insert()` í˜¸ì¶œ
- íŒŒì¼ ì—…ë¡œë“œ
- ë©”íƒ€ë°ì´í„° ì„¤ì •

#### 5-4. ê²°ê³¼ ì €ì¥
- `youtube_uploads` í…Œì´ë¸”ì— ì—…ë¡œë“œ ê¸°ë¡
- `video_schedules`ì— `youtube_upload_id` ê¸°ë¡
- YouTube URL ì €ì¥
- íŒŒì´í”„ë¼ì¸ ìƒíƒœë¥¼ 'completed'ë¡œ ì—…ë°ì´íŠ¸

---

### **Step 6: YouTube í¼ë¸”ë¦¬ì‹œ (Stage 4: Publish)**

#### 6-1. í•¨ìˆ˜: `scheduleYouTubePublish()` (Line 1016)

#### 6-2. í¼ë¸”ë¦¬ì‹œ ì„¤ì •
- **ì˜µì…˜ 1**: Immediate (ì¦‰ì‹œ ê³µê°œ)
  ```typescript
  if (schedule.youtube_schedule === 'immediate') {
    // ë°”ë¡œ ê³µê°œ
  }
  ```

- **ì˜µì…˜ 2**: Scheduled (ì˜ˆì•½ ê³µê°œ)
  ```typescript
  if (schedule.youtube_schedule === 'scheduled') {
    youtube.videos().update({
      publishAt: schedule.youtube_publish_time // ISO ì‹œê°„
    });
  }
  ```

#### 6-3. ìµœì¢… ìƒíƒœ ì—…ë°ì´íŠ¸
- `video_schedules` ìƒíƒœ: 'completed'
- `video_titles` ìƒíƒœ: 'completed'
- `automation_pipelines` ëª¨ë“  ë‹¨ê³„: 'completed'

---

### **Step 7: ìˆí¼ ìë™ ìƒì„± (ë¡±í¼ì¸ ê²½ìš°)**

#### 7-1. ìë™ íŠ¸ë¦¬ê±°
```typescript
if (schedule.type === 'longform') {
  // ë¡±í¼ ì™„ë£Œ â†’ ìë™ìœ¼ë¡œ ìˆí¼ ìƒì„±
  uploadShortForm(videoResult.videoUrl);
}
```

#### 7-2. ìˆí¼ ìƒì„± í”„ë¡œì„¸ìŠ¤
- ë¡±í¼ ì˜ìƒì—ì„œ ì£¼ìš” ì¥ë©´ ì¶”ì¶œ
- ìë§‰ ì¶”ì¶œ + ìŒì„± ì¶”ì¶œ
- 15ì´ˆ~60ì´ˆ ìˆí¼ í´ë¦½ ìƒì„±
- YouTube Shortsë¡œ ì—…ë¡œë“œ

---

### ğŸ“Š ìƒíƒœ ê´€ë¦¬ íë¦„

```
pending
   â†“
[Stage 1: Script Generation]
   â†“
waiting_for_upload (ì§ì ‘ì—…ë¡œë“œì¸ ê²½ìš°ë§Œ)
   â†“ [ì‚¬ìš©ì: ì´ë¯¸ì§€ í¬ë¡¤ë§]
processing
   â†“
[Stage 2: Video Generation]
   â†“
[Stage 3: YouTube Upload]
   â†“
[Stage 4: Publish]
   â†“
completed
```

**ì‹¤íŒ¨ ì‹œ**:
- `status='failed'`
- `automation_pipelines`ì— error_message ê¸°ë¡
- ì¬ì‹œë„ ë¡œì§: max_retryë§Œí¼ ìë™ ì¬ì‹œë„
- ìµœì¢… ì‹¤íŒ¨ ì‹œ ì‚¬ìš©ì ì•Œë¦¼

---

### ğŸ”‘ Key Features

1. **ì™„ì „ ìë™í™”**: 4ë‹¨ê³„ íŒŒì´í”„ë¼ì¸ ìë™ ì²˜ë¦¬
2. **ì¤‘ë‹¨ì **: ì§ì ‘ ì—…ë¡œë“œ ì„ íƒ ì‹œ ì´ë¯¸ì§€ ì¤€ë¹„í•  ë•Œê¹Œì§€ ëŒ€ê¸°
3. **ì´ë¯¸ì§€ ê°ì§€**: ìë™ìœ¼ë¡œ ì´ë¯¸ì§€ ê°ì§€ â†’ ìë™ ì¬ê°œ
4. **ì—ëŸ¬ ì²˜ë¦¬**: ê° ë‹¨ê³„ë³„ ì—ëŸ¬ ê¸°ë¡ + ì¬ì‹œë„
5. **ë¡œê·¸ ê´€ë¦¬**: ì‹¤ì‹œê°„ ì§„í–‰ ìƒí™© ë¡œê¹…
6. **ë¡±í¼â†’ìˆí¼**: ë¡±í¼ ì™„ë£Œ í›„ ìë™ ìˆí¼ ìƒì„±

---

**ê´€ë ¨ íŒŒì¼**:
- `src/lib/automation-scheduler.ts` - ìŠ¤ì¼€ì¤„ëŸ¬ ë©”ì¸ ë¡œì§ (1500+ ë¼ì¸)
- `src/lib/automation.ts` - DB ì¿¼ë¦¬ ë° í—¬í¼ í•¨ìˆ˜
- `src/app/api/scripts/generate/route.ts` - ëŒ€ë³¸ ìƒì„± API
- `src/app/api/generate-video-upload/route.ts` - ì˜ìƒ ìƒì„± API
- `src/app/api/youtube/upload/route.ts` - YouTube ì—…ë¡œë“œ API
- `trend-video-backend/create_video_from_folder.py` - ì˜ìƒ ìƒì„± Python
- `trend-video-backend/src/video_generator/long_form_creator.py` - ë¡±í¼ ìƒì„±

**ì£¼ìš” í•¨ìˆ˜**:
- `startAutomationScheduler()` - ìŠ¤ì¼€ì¤„ëŸ¬ ì‹œì‘
- `processPendingSchedules()` - pending ìŠ¤ì¼€ì¤„ ì²˜ë¦¬
- `checkWaitingForUploadSchedules()` - ì´ë¯¸ì§€ ì—…ë¡œë“œ ëŒ€ê¸° ìŠ¤ì¼€ì¤„ í™•ì¸ â­ NEW
- `resumeVideoGeneration()` - ì´ë¯¸ì§€ ê°ì§€ í›„ ì˜ìƒ ìƒì„± ì¬ê°œ â­ NEW
- `executePipeline()` - ì „ì²´ íŒŒì´í”„ë¼ì¸ ì‹¤í–‰
- `generateScript()` - Stage 1
- `generateVideo()` - Stage 2
- `uploadToYouTube()` - Stage 3
- `scheduleYouTubePublish()` - Stage 4

**ìƒíƒœ**: âœ… ì™„ë£Œ (ì§ì ‘ì—…ë¡œë“œ + ì´ë¯¸ì§€ ê°ì§€ í¬í•¨)

---

## ê¸°íƒ€ ê¸°ëŠ¥

(ì¶”ê°€ ê¸°ëŠ¥ì€ ì—¬ê¸°ì— ì‘ì„±)
