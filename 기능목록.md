# 트렌드 비디오 자동화 기능 목록

## 상품 자동화 기능

### 쿠팡 베스트셀러 자동 등록 및 예약
**구현 위치**: `src/app/api/automation/test-generate-stream/route.ts`

**동작 흐름**:
1. **내 목록 우선 확인**
   - DB의 `coupang_products` 테이블에서 등록된 상품 조회
   - 최신 상품 우선 선택 (`ORDER BY created_at DESC`)

2. **베스트셀러 자동 가져오기** (내 목록이 비어있을 경우)
   - 쿠팡 베스트셀러 API 호출 (`/v2/providers/affiliate_open_api/apis/openapi/v1/products/bestcategories/1001`)
   - HMAC-SHA256 서명으로 인증
   - 베스트셀러 1위 상품 자동 선택

3. **딥링크 자동 생성**
   - 긴 affiliate URL을 짧은 딥링크로 변환
   - `https://link.coupang.com/a/xxxxx` 형태로 변환
   - `generateDeeplink()` 유틸리티 함수 사용

4. **자동화 예약큐 등록**
   - `video_titles` 테이블에 상품 정보 저장
   - AI 제목 생성 및 품질 평가
   - 스케줄 자동 설정

**관련 파일**:
- `src/app/api/automation/test-generate-stream/route.ts` - 메인 로직
- `src/lib/coupang-deeplink.ts` - 딥링크 생성 유틸리티
- `src/app/api/coupang/products/route.ts` - 베스트셀러 조회 API (24시간 캐시)

**특징**:
- 24시간 캐시로 빠른 베스트셀러 조회
- 자동 딥링크 변환으로 짧은 링크 보장
- DB 우선 → API 폴백 2단계 전략
- 사용자 개입 없이 완전 자동화

---

## 상품 타이틀 자동 생성

**구현 위치**: `src/app/api/automation/titles/route.ts`

**동작 흐름**:
1. **상품 정보 조회**
   - 쿠팡 상품 URL에서 상품 ID 추출
   - API를 통해 상품 이름, 가격, 카테고리 등 조회

2. **AI 타이틀 생성**
   - 상품 정보를 기반으로 프롬프트 생성
   - Claude/ChatGPT API 호출
   - 유튜브 최적화 타이틀 생성

3. **타이틀 저장**
   - `video_titles` 테이블에 저장
   - 상품 정보(JSON) 함께 저장

**관련 파일**:
- `src/app/api/automation/titles/route.ts` - 타이틀 API
- `src/lib/automation.ts` - DB 쿼리 함수

**상태**: ⚠️ 부분 구현 (수동 입력은 가능, 자동 생성은 미구현)

---

## 자동화 스케줄 관리

**구현 위치**: `src/app/api/automation/schedules/route.ts`

**동작 흐름**:
1. **스케줄 생성**
   - 타이틀 선택
   - 채널 선택
   - 업로드 날짜/시간 설정
   - YouTube 프라이버시 설정

2. **스케줄 조회**
   - 채널별 스케줄 조회
   - 상태별 스케줄 필터링 (pending, processing, completed, failed, cancelled)
   - 달력 뷰로 조회

3. **스케줄 실행**
   - `video_schedules` 테이블에서 pending 상태 조회
   - 자동화 스케줄러가 이를 처리

**관련 파일**:
- `src/app/api/automation/schedules/route.ts` - 스케줄 관리 API
- `src/app/api/automation/calendar/route.ts` - 캘린더 조회 API
- `src/lib/automation.ts` - DB 쿼리 함수
- `src/lib/automation-scheduler.ts` - 스케줄 실행 로직

**상태**: ✅ 완료

---

## 자동화 스케줄러 (자동 실행)

**구현 위치**: `src/lib/automation-scheduler.ts`

**동작 흐름**:
1. **스케줄 감시** (3초 간격)
   - pending 상태의 스케줄 조회
   - 실행할 작업 확인

2. **대본 생성**
   - `/api/generate-script` 호출
   - 상품 정보 + 타이틀 기반 대본 생성

3. **영상 생성**
   - `/api/generate-video` 호출
   - 대본 + 이미지/영상 기반 영상 생성

4. **상태 업데이트**
   - `automation_pipelines` 테이블에 진행 상황 기록
   - 각 단계별 로그 저장

5. **YouTube 업로드**
   - `/api/youtube/upload` 호출
   - 메타데이터(제목, 설명, 태그) 설정
   - 완료 상태로 업데이트

**관련 파일**:
- `src/lib/automation-scheduler.ts` - 스케줄러 메인 로직 (1200+ 라인)
- `src/lib/automation.ts` - DB 쿼리 및 헬퍼 함수
- `src/app/api/generate-script/route.ts` - 대본 생성 API
- `src/app/api/generate-video/route.ts` - 영상 생성 API
- `src/app/api/youtube/upload/route.ts` - YouTube 업로드 API

**주요 함수**:
- `startAutomationScheduler()` - 스케줄러 시작
- `processPendingSchedules()` - pending 스케줄 처리
- `checkAndCreateAutoSchedules()` - 자동 스케줄 생성
- `updateScheduleStatus()` - 상태 업데이트

**상태**: ✅ 완료

---

## 기타 기능

(추가 기능은 여기에 작성)
